---
title: "CASYS :: Intel SGX"
date: 2021-02-08 12:51:00 +0900
categories: Study
tags: 논문
---

DRAM, SRAM 모두 전원 끊기면 자료 사라지는 휘발성 메모리
DRAM : 축전기로 작동 -> 시간이 지나면 스스로 방전 -> 주기적으로 refresh(재충전) 시켜줘야 함
SRAM : 플리플롭으로 작동 -> 전류신호가 오기 전에는 상태가 변하지 않음 -> 메모리만 기억하면 되므로 DRAM보다 빠르지만, 용량은 작음(전력 소모가 커서?)

프로세스/스레드 : https://gmlwjd9405.github.io/2018/09/14/process-vs-thread.html

# 5 SGX PROGRAMMING MODEL

encalve는 외부로부터 isloated 되며, 외부에서 enclave 내부의 software를 authenticate할 수 있도록 software attestation을 지원한다.

## 5.1 SGX Physical Memory Organization

enclave의 code와 data는 다른 sw가 접근할 수 없는 **Processor Reserved Memory (PRM)** 에 저장된다.

PRM은 continuous range of memory여서, 특정 address가 PRM에 속하는지 판단하기가 쉽다.

### 5.1.1 The Enclave Page Cache (EPC)

![fig60](https://imgur.com/sq1lsD1.png)

Enclave의 content와 associated data structure은 PRM의 일부인 **Enclave Page Cache (EPC)** 에 저장된다.

EPC는 (address translation의 단위와 같은) 4KB pages로 나눠지며, 각 page는 서로 다른 enclave에 배정될 수 있다.

(Hypervisor나 OS kernel 같은) system software가 EPC를 관리하며, enclave의 memory를 allocate/free한다.

Non-enclave software는 EPC (in PRM)에 접근할 수 없지만, enclave initializtion시 EPC page는 non-PRM memory page로부터 복사해온다.

### 5.1.2 The Enclave Page Cache Map (EPCM)

EPC page를 할당/해제하는 system software는 untrusted기 때문에, SGX processor는 EPC page allocation에 관한 정보를 **Enclave Page Cache Map (EPCM)** 에 적어둔다.

EPCM의 entry는 EPC의 entry와 일대일 대응되며, SGX의 security check시에만 사용된다. 

![table13](https://imgur.com/RnlBza8.png)

EPCM entry
- valid
- page type (PT)
  - enclave의 code/data를 담는 페이지인지, 다른 data structure를 담는 페이지인지 구분함
- enclavesecs : enclave가 다른 enclave의 page에 접근하지 못하게 함

### 5.1.3 The SGX Enclave Control Structure (SECS)

sensitive per-enclave metadata는 **SGX Enclave Control Structure (SECS)** 에 보관하며, enclave code도 SECS에 접근할 수 없다.

EPC page의 주인을 판단하기 위한 EPCM enclavesecs 필드는 owner enclave의 SECS를 가리키듯, SECS의 주소를 이용해 enclave를 식별한다.

Enclave의 시작과 끝은 해당 enclave의 SECS를 담기 위한 EPC page를 할당/해제 하는 것이다.



